{"schema_version":"1.7.3","id":"DEBIAN-CVE-2024-57996","published":"2025-02-27T02:15:13Z","modified":"2025-10-13T11:19:17.491025Z","upstream":["CVE-2024-57996"],"details":"In the Linux kernel, the following vulnerability has been resolved:  net_sched: sch_sfq: don't allow 1 packet limit  The current implementation does not work correctly with a limit of 1. iproute2 actually checks for this and this patch adds the check in kernel as well.  This fixes the following syzkaller reported crash:  UBSAN: array-index-out-of-bounds in net/sched/sch_sfq.c:210:6 index 65535 is out of range for type 'struct sfq_head[128]' CPU: 0 PID: 2569 Comm: syz-executor101 Not tainted 5.10.0-smp-DEV #1 Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024 Call Trace:   __dump_stack lib/dump_stack.c:79 [inline]   dump_stack+0x125/0x19f lib/dump_stack.c:120   ubsan_epilogue lib/ubsan.c:148 [inline]   __ubsan_handle_out_of_bounds+0xed/0x120 lib/ubsan.c:347   sfq_link net/sched/sch_sfq.c:210 [inline]   sfq_dec+0x528/0x600 net/sched/sch_sfq.c:238   sfq_dequeue+0x39b/0x9d0 net/sched/sch_sfq.c:500   sfq_reset+0x13/0x50 net/sched/sch_sfq.c:525   qdisc_reset+0xfe/0x510 net/sched/sch_generic.c:1026   tbf_reset+0x3d/0x100 net/sched/sch_tbf.c:319   qdisc_reset+0xfe/0x510 net/sched/sch_generic.c:1026   dev_reset_queue+0x8c/0x140 net/sched/sch_generic.c:1296   netdev_for_each_tx_queue include/linux/netdevice.h:2350 [inline]   dev_deactivate_many+0x6dc/0xc20 net/sched/sch_generic.c:1362   __dev_close_many+0x214/0x350 net/core/dev.c:1468   dev_close_many+0x207/0x510 net/core/dev.c:1506   unregister_netdevice_many+0x40f/0x16b0 net/core/dev.c:10738   unregister_netdevice_queue+0x2be/0x310 net/core/dev.c:10695   unregister_netdevice include/linux/netdevice.h:2893 [inline]   __tun_detach+0x6b6/0x1600 drivers/net/tun.c:689   tun_detach drivers/net/tun.c:705 [inline]   tun_chr_close+0x104/0x1b0 drivers/net/tun.c:3640   __fput+0x203/0x840 fs/file_table.c:280   task_work_run+0x129/0x1b0 kernel/task_work.c:185   exit_task_work include/linux/task_work.h:33 [inline]   do_exit+0x5ce/0x2200 kernel/exit.c:931   do_group_exit+0x144/0x310 kernel/exit.c:1046   __do_sys_exit_group kernel/exit.c:1057 [inline]   __se_sys_exit_group kernel/exit.c:1055 [inline]   __x64_sys_exit_group+0x3b/0x40 kernel/exit.c:1055  do_syscall_64+0x6c/0xd0  entry_SYSCALL_64_after_hwframe+0x61/0xcb RIP: 0033:0x7fe5e7b52479 Code: Unable to access opcode bytes at RIP 0x7fe5e7b5244f. RSP: 002b:00007ffd3c800398 EFLAGS: 00000246 ORIG_RAX: 00000000000000e7 RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe5e7b52479 RDX: 000000000000003c RSI: 00000000000000e7 RDI: 0000000000000000 RBP: 00007fe5e7bcd2d0 R08: ffffffffffffffb8 R09: 0000000000000014 R10: 0000000000000000 R11: 0000000000000246 R12: 00007fe5e7bcd2d0 R13: 0000000000000000 R14: 00007fe5e7bcdd20 R15: 00007fe5e7b24270  The crash can be also be reproduced with the following (with a tc recompiled to allow for sfq limits of 1):  tc qdisc add dev dummy0 handle 1: root tbf rate 1Kbit burst 100b lat 1s ../iproute2-6.9.0/tc/tc qdisc add dev dummy0 handle 2: parent 1:10 sfq limit 1 ifconfig dummy0 up ping -I dummy0 -f -c2 -W0.1 8.8.8.8 sleep 1  Scenario that triggers the crash:  * the first packet is sent and queued in TBF and SFQ; qdisc qlen is 1  * TBF dequeues: it peeks from SFQ which moves the packet to the   gso_skb list and keeps qdisc qlen set to 1. TBF is out of tokens so   it schedules itself for later.  * the second packet is sent and TBF tries to queues it to SFQ. qdisc   qlen is now 2 and because the SFQ limit is 1 the packet is dropped   by SFQ. At this point qlen is 1, and all of the SFQ slots are empty,   however q->tail is not NULL.  At this point, assuming no more packets are queued, when sch_dequeue runs again it will decrement the qlen for the current empty slot causing an underflow and the subsequent out of bounds access.","affected":[{"package":{"name":"linux","ecosystem":"Debian:11","purl":"pkg:deb/debian/linux?arch=source"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"5.10.244-1"}]}],"versions":["5.10.103-1","5.10.103-1~bpo10+1","5.10.106-1","5.10.113-1","5.10.120-1","5.10.120-1~bpo10+1","5.10.127-1","5.10.127-2","5.10.127-2~bpo10+1","5.10.136-1","5.10.140-1","5.10.148-1","5.10.149-1","5.10.149-2","5.10.158-1","5.10.158-2","5.10.162-1","5.10.178-1","5.10.178-2","5.10.178-3","5.10.179-1","5.10.179-2","5.10.179-3","5.10.179-4","5.10.179-5","5.10.191-1","5.10.197-1","5.10.205-1","5.10.205-2","5.10.209-1","5.10.209-2","5.10.216-1","5.10.218-1","5.10.221-1","5.10.223-1","5.10.226-1","5.10.234-1","5.10.237-1","5.10.46-4","5.10.46-5","5.10.70-1","5.10.70-1~bpo10+1","5.10.84-1","5.10.92-1","5.10.92-1~bpo10+1","5.10.92-2"],"ecosystem_specific":{"urgency":"not yet assigned"},"database_specific":{"source":"https://storage.googleapis.com/debian-osv/debian-cve-osv/DEBIAN-CVE-2024-57996.json"}},{"package":{"name":"linux","ecosystem":"Debian:12","purl":"pkg:deb/debian/linux?arch=source"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"6.1.129-1"}]}],"versions":["6.1.106-1","6.1.106-2","6.1.106-3","6.1.112-1","6.1.115-1","6.1.119-1","6.1.123-1","6.1.124-1","6.1.128-1","6.1.27-1","6.1.37-1","6.1.38-1","6.1.38-2","6.1.38-2~bpo11+1","6.1.38-3","6.1.38-4","6.1.38-4~bpo11+1","6.1.52-1","6.1.55-1","6.1.55-1~bpo11+1","6.1.64-1","6.1.66-1","6.1.67-1","6.1.69-1","6.1.69-1~bpo11+1","6.1.76-1","6.1.76-1~bpo11+1","6.1.82-1","6.1.85-1","6.1.90-1","6.1.90-1~bpo11+1","6.1.94-1","6.1.94-1~bpo11+1","6.1.98-1","6.1.99-1"],"ecosystem_specific":{"urgency":"not yet assigned"},"database_specific":{"source":"https://storage.googleapis.com/debian-osv/debian-cve-osv/DEBIAN-CVE-2024-57996.json"}},{"package":{"name":"linux","ecosystem":"Debian:13","purl":"pkg:deb/debian/linux?arch=source"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"6.12.13-1"}]}],"ecosystem_specific":{"urgency":"not yet assigned"},"database_specific":{"source":"https://storage.googleapis.com/debian-osv/debian-cve-osv/DEBIAN-CVE-2024-57996.json"}},{"package":{"name":"linux","ecosystem":"Debian:14","purl":"pkg:deb/debian/linux?arch=source"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"6.12.13-1"}]}],"ecosystem_specific":{"urgency":"not yet assigned"},"database_specific":{"source":"https://storage.googleapis.com/debian-osv/debian-cve-osv/DEBIAN-CVE-2024-57996.json"}},{"package":{"name":"linux-6.1","ecosystem":"Debian:11","purl":"pkg:deb/debian/linux-6.1?arch=source"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"6.1.129-1~deb11u1"}]}],"versions":["6.1.106-3~deb11u1","6.1.106-3~deb11u2","6.1.106-3~deb11u3","6.1.112-1~deb11u1","6.1.119-1~deb11u1","6.1.128-1~deb11u1"],"ecosystem_specific":{"urgency":"not yet assigned"},"database_specific":{"source":"https://storage.googleapis.com/debian-osv/debian-cve-osv/DEBIAN-CVE-2024-57996.json"}}],"references":[{"type":"ADVISORY","url":"https://security-tracker.debian.org/tracker/CVE-2024-57996"}],"severity":[{"type":"CVSS_V3","score":"CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"}]}