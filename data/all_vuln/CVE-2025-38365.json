{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-38365.json"
      },
      "ecosystem_specific": {
        "urgency": "not yet assigned"
      },
      "package": {
        "ecosystem": "Debian:12",
        "name": "linux",
        "purl": "pkg:deb/debian/linux?arch=source"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": [
        "6.1.106-1",
        "6.1.106-2",
        "6.1.106-3",
        "6.1.112-1",
        "6.1.115-1",
        "6.1.119-1",
        "6.1.123-1",
        "6.1.124-1",
        "6.1.128-1",
        "6.1.129-1",
        "6.1.133-1",
        "6.1.135-1",
        "6.1.137-1",
        "6.1.139-1",
        "6.1.140-1",
        "6.1.27-1",
        "6.1.37-1",
        "6.1.38-1",
        "6.1.38-2",
        "6.1.38-2~bpo11+1",
        "6.1.38-3",
        "6.1.38-4",
        "6.1.38-4~bpo11+1",
        "6.1.52-1",
        "6.1.55-1",
        "6.1.55-1~bpo11+1",
        "6.1.64-1",
        "6.1.66-1",
        "6.1.67-1",
        "6.1.69-1",
        "6.1.69-1~bpo11+1",
        "6.1.76-1",
        "6.1.76-1~bpo11+1",
        "6.1.82-1",
        "6.1.85-1",
        "6.1.90-1",
        "6.1.90-1~bpo11+1",
        "6.1.94-1",
        "6.1.94-1~bpo11+1",
        "6.1.98-1",
        "6.1.99-1",
        "6.10-1~exp1",
        "6.10.1-1~exp1",
        "6.10.11-1",
        "6.10.11-1~bpo12+1",
        "6.10.12-1",
        "6.10.3-1",
        "6.10.4-1",
        "6.10.6-1",
        "6.10.6-1~bpo12+1",
        "6.10.7-1",
        "6.10.9-1",
        "6.11-1~exp1",
        "6.11.10-1",
        "6.11.10-1~bpo12+1",
        "6.11.2-1",
        "6.11.4-1",
        "6.11.5-1",
        "6.11.5-1~bpo12+1",
        "6.11.6-1",
        "6.11.7-1",
        "6.11.9-1",
        "6.11~rc4-1~exp1",
        "6.11~rc5-1~exp1",
        "6.12.10-1",
        "6.12.11-1",
        "6.12.11-1+alpha",
        "6.12.11-1+alpha.1",
        "6.12.12-1",
        "6.12.12-1~bpo12+1",
        "6.12.13-1",
        "6.12.15-1",
        "6.12.16-1",
        "6.12.17-1",
        "6.12.19-1",
        "6.12.20-1",
        "6.12.21-1",
        "6.12.22-1",
        "6.12.22-1~bpo12+1",
        "6.12.25-1",
        "6.12.27-1",
        "6.12.27-1~bpo12+1",
        "6.12.29-1",
        "6.12.3-1",
        "6.12.30-1",
        "6.12.30-1~bpo12+1",
        "6.12.31-1",
        "6.12.32-1",
        "6.12.32-1~bpo12+1",
        "6.12.33-1",
        "6.12.33-1~bpo12+1",
        "6.12.35-1",
        "6.12.35-1~bpo12+1",
        "6.12.37-1",
        "6.12.38-1",
        "6.12.5-1",
        "6.12.6-1",
        "6.12.8-1",
        "6.12.9-1",
        "6.12.9-1+alpha",
        "6.12.9-1~bpo12+1",
        "6.12~rc6-1~exp1",
        "6.13.10-1~exp1",
        "6.13.11-1~exp1",
        "6.13.2-1~exp1",
        "6.13.3-1~exp1",
        "6.13.4-1~exp1",
        "6.13.5-1~exp1",
        "6.13.6-1~exp1",
        "6.13.7-1~exp1",
        "6.13.8-1~exp1",
        "6.13.9-1~exp1",
        "6.13~rc6-1~exp1",
        "6.13~rc7-1~exp1",
        "6.14.3-1~exp1",
        "6.14.5-1~exp1",
        "6.14.6-1~exp1",
        "6.15-1~exp1",
        "6.15.1-1~exp1",
        "6.15.2-1~exp1",
        "6.15.3-1~exp1",
        "6.15.4-1~exp1",
        "6.15.5-1~exp1",
        "6.15.6-1~exp1",
        "6.15~rc7-1~exp1",
        "6.16~rc7-1~exp1",
        "6.3.1-1~exp1",
        "6.3.11-1",
        "6.3.2-1~exp1",
        "6.3.4-1~exp1",
        "6.3.5-1~exp1",
        "6.3.7-1",
        "6.3.7-1~bpo12+1",
        "6.4.1-1~exp1",
        "6.4.11-1",
        "6.4.13-1",
        "6.4.4-1",
        "6.4.4-1~bpo12+1",
        "6.4.4-2",
        "6.4.4-3",
        "6.4.4-3~bpo12+1",
        "6.4~rc6-1~exp1",
        "6.4~rc7-1~exp1",
        "6.5.1-1~exp1",
        "6.5.10-1",
        "6.5.10-1~bpo12+1",
        "6.5.13-1",
        "6.5.3-1",
        "6.5.3-1~bpo12+1",
        "6.5.6-1",
        "6.5.8-1",
        "6.5~rc4-1~exp1",
        "6.5~rc6-1~exp1",
        "6.5~rc7-1~exp1",
        "6.6.11-1",
        "6.6.13-1",
        "6.6.13-1~bpo12+1",
        "6.6.15-1",
        "6.6.15-2",
        "6.6.3-1~exp1",
        "6.6.4-1~exp1",
        "6.6.7-1~exp1",
        "6.6.8-1",
        "6.6.9-1",
        "6.7-1~exp1",
        "6.7.1-1~exp1",
        "6.7.12-1",
        "6.7.12-1~bpo12+1",
        "6.7.4-1~exp1",
        "6.7.7-1",
        "6.7.9-1",
        "6.7.9-2",
        "6.8.11-1",
        "6.8.12-1",
        "6.8.12-1~bpo12+1",
        "6.8.9-1",
        "6.9.10-1",
        "6.9.10-1~bpo12+1",
        "6.9.11-1",
        "6.9.12-1",
        "6.9.2-1~exp1",
        "6.9.7-1",
        "6.9.7-1~bpo12+1",
        "6.9.8-1",
        "6.9.9-1"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-38365.json"
      },
      "ecosystem_specific": {
        "urgency": "not yet assigned"
      },
      "package": {
        "ecosystem": "Debian:13",
        "name": "linux",
        "purl": "pkg:deb/debian/linux?arch=source"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "6.12.37-1"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: fix a race between renames and directory logging\n\nWe have a race between a rename and directory inode logging that if it\nhappens and we crash/power fail before the rename completes, the next time\nthe filesystem is mounted, the log replay code will end up deleting the\nfile that was being renamed.\n\nThis is best explained following a step by step analysis of an interleaving\nof steps that lead into this situation.\n\nConsider the initial conditions:\n\n1) We are at transaction N;\n\n2) We have directories A and B created in a past transaction (< N);\n\n3) We have inode X corresponding to a file that has 2 hardlinks, one in\n   directory A and the other in directory B, so we'll name them as\n   \"A/foo_link1\" and \"B/foo_link2\". Both hard links were persisted in a\n   past transaction (< N);\n\n4) We have inode Y corresponding to a file that as a single hard link and\n   is located in directory A, we'll name it as \"A/bar\". This file was also\n   persisted in a past transaction (< N).\n\nThe steps leading to a file loss are the following and for all of them we\nare under transaction N:\n\n 1) Link \"A/foo_link1\" is removed, so inode's X last_unlink_trans field\n    is updated to N, through btrfs_unlink() -> btrfs_record_unlink_dir();\n\n 2) Task A starts a rename for inode Y, with the goal of renaming from\n    \"A/bar\" to \"A/baz\", so we enter btrfs_rename();\n\n 3) Task A inserts the new BTRFS_INODE_REF_KEY for inode Y by calling\n    btrfs_insert_inode_ref();\n\n 4) Because the rename happens in the same directory, we don't set the\n    last_unlink_trans field of directoty A's inode to the current\n    transaction id, that is, we don't cal btrfs_record_unlink_dir();\n\n 5) Task A then removes the entries from directory A (BTRFS_DIR_ITEM_KEY\n    and BTRFS_DIR_INDEX_KEY items) when calling __btrfs_unlink_inode()\n    (actually the dir index item is added as a delayed item, but the\n    effect is the same);\n\n 6) Now before task A adds the new entry \"A/baz\" to directory A by\n    calling btrfs_add_link(), another task, task B is logging inode X;\n\n 7) Task B starts a fsync of inode X and after logging inode X, at\n    btrfs_log_inode_parent() it calls btrfs_log_all_parents(), since\n    inode X has a last_unlink_trans value of N, set at in step 1;\n\n 8) At btrfs_log_all_parents() we search for all parent directories of\n    inode X using the commit root, so we find directories A and B and log\n    them. Bu when logging direct A, we don't have a dir index item for\n    inode Y anymore, neither the old name \"A/bar\" nor for the new name\n    \"A/baz\" since the rename has deleted the old name but has not yet\n    inserted the new name - task A hasn't called yet btrfs_add_link() to\n    do that.\n\n    Note that logging directory A doesn't fallback to a transaction\n    commit because its last_unlink_trans has a lower value than the\n    current transaction's id (see step 4);\n\n 9) Task B finishes logging directories A and B and gets back to\n    btrfs_sync_file() where it calls btrfs_sync_log() to persist the log\n    tree;\n\n10) Task B successfully persisted the log tree, btrfs_sync_log() completed\n    with success, and a power failure happened.\n\n    We have a log tree without any directory entry for inode Y, so the\n    log replay code deletes the entry for inode Y, name \"A/bar\", from the\n    subvolume tree since it doesn't exist in the log tree and the log\n    tree is authorative for its index (we logged a BTRFS_DIR_LOG_INDEX_KEY\n    item that covers the index range for the dentry that corresponds to\n    \"A/bar\").\n\n    Since there's no other hard link for inode Y and the log replay code\n    deletes the name \"A/bar\", the file is lost.\n\nThe issue wouldn't happen if task B synced the log only after task A\ncalled btrfs_log_new_name(), which would update the log with the new name\nfor inode Y (\"A/bar\").\n\nFix this by pinning the log root during renames before removing the old\ndirectory entry, and unpinning af\n---truncated---",
  "id": "CVE-2025-38365",
  "modified": "2025-07-29T11:22:37.215218Z",
  "published": "2025-07-25T13:15:25Z",
  "references": [
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/2088895d5903082bb9021770b919e733c57edbc1"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/3ca864de852bc91007b32d2a0d48993724f4abad"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/51bd363c7010d033d3334daf457c824484bf9bf0"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/8c6874646c21bd820cf475e2874e62c133954023"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/aeeae8feeaae4445a86f9815273e81f902dc1f5b"
    },
    {
      "type": "ADVISORY",
      "url": "https://security-tracker.debian.org/tracker/CVE-2025-38365"
    }
  ],
  "schema_version": "1.7.0"
}